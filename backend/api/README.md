
# Stencil backend API

API methods for post/update database in Stencil.

### Get - /libraries [GET /libraries  /libraries/dbid/:dbid]

Used to retrieve list of libraries in Stencil database based on some search criteria.



**Response Fields** 

|Field|Type|Description|
|---|---|---|
|dbId|string|Internal database ID of a library, automatically generated by the database;|
|libraryId|string| User defined  ID of the library which should be unique within a project. |
|sampleId|string| User defined ID of the sample. If not specified, it will copy the value from libraryId. |
|projectId|string|User defined ID of a project.|
|groupTag|object|A dictionary of group tags, for example, {"sampleId":"xyz", targetId":"abc"}.|
|libraryType|string|The type of library, e.g. "RNAseq".|
|libraryData|array|Data analysis results.|
|createdBy|string|User name who created the object|
|createTimestamp|string (date-time)|The time of sample registration.|
|updatedBy|string|User name who late updated the object.|
|updateTimestamp|string (date-time)|The time of last update.|
|status|string|Status code of the library,  "1" (default) for active; "0" for "deprecated";|




+ Parameters
    + dbId (Optional, ) ... the internal DB id for a library
    + libraryId (optional) ... the library ID
    + sampleId(optional) ... the sample ID
    + projectId(Optional, ) ... the projectId of a library




+ Response 200 (application/json)
```
{
	"message" : "success",
	"libraries": [
					{"_id": "9343lajsfasfda",
					"libraryId": "1",
					"sampleId": "1",
					"libraryDescription": "",
					"projectId": "1",
					"groupTag": {"targetId":"abc"},
					"libraryType": "RNAseq",
					"libraryData":[
                            {	"layoutId": "tag-pileup-raw-data",
                            	"layoutTitle": "Tag Pileup",
                            	"workflowStepId": "180208b3deba8d04",
                            	"workflowId": "1cd8e2f6b131e891",
                            	"genome" : "sacCer3_cegr",	
                           		"dataType": "txt",
                           		"URL": "http://xxx.xxx.xxx/xxx",
                            }
						],
					"createdBy": "user1",
					"createTimestamp":"2020-11-02",
					"updatedBy": "user2",
					"updateTimestamp":"2020-11-02",
					"status":"1"           
					}  
				]
 }
```

### Post - /libraries [POST /libraries]

Call to register the event of a library being taken. Library ID is assigned as a result of the operation and returned in response.

**Request Fields** 

|Field|Type|Description|
|---|---|---|
|libraryId|string (required)| User defined  ID of the library which should be unique within a project; |
|sampleId|string| User defined ID of the sample. If not specified, it will copy the value from libraryId. |
|projectId|string (required)|User defined ID of a project.|
|groupTag|object|A dictionary of group tags, for example, {"sampleId":"xyz", targetId":"abc"}.|
|libraryType|string|The type of library, e.g. "RNAseq".|
|libraryData|array|Data analysis results. Each element is a dictionary  {string:string}, with at least two required keys "layoutId", "stepId" and optional field "tabId".  "layoutTitle" and "tabTitle" are optional. If not available, "layoutId" and "tabId" will be displayed.|

**Response Fields** 

|Field|Type|Description|
|---|---|---|
|dbId|string|Internal database ID of a library, automatically generated by the database;|
|libraryId|string| User defined  ID of the library which should be unique within a project; |
|sampleId|string| User defined ID of the sample. If not specified, it will copy the value from libraryId. |
|projectId|string|User defined ID of a project.|
|groupTag|object|A dictionary of group tags, for example, {"sampleId":"xyz", targetId":"abc"}.|
|libraryType|string|The type of library, e.g. "RNAseq".|
|libraryData|array|An array of data object associated with the library|
|createdBy|string|User name who created the object|
|createTimestamp|string (date-time)|The time of sample registration.|
|updatedBy|string|User name who late updated the object.|
|updateTimestamp|string (date-time)|The time of last update.|
|status|string|Status code of the library,  "1" (default) for active; "0" for "deprecated";|


+ Parameters


+ Request (application/json)
```
{
    "libraryId": "1",
    "sampleId": "1",
    "libraryDescription": "",
    "projectId": "1",
    "groupTag": {"targetId":"abc"},
    "libraryType": "RNAseq",
    "libraryData":[
        {
        "layoutId": "Heat Map 1",
        "layoutTitle": "Heat Map 1",
        "tabId": "Tab1",
        "tabTitle": "Tab 1",
        "stepId": "1",
        "workflowId": "1cd8e2f6b131e891",
        "dataType": "png",
        "dataLabel": "fig1.1"
        "URL": "http://128.84.9.200:8080/datasets/7eee9617b2705f10/display?preview=True",
        }
    ]
}  
```

+ Response 200 (application/json)
```
{
	"message" : "success",
    "libraries": [
                    {
                        "_id": "9343lajsfasfda",
                        "libraryId": "1",
                        "sampleId": "1",
                        "libraryDescription": "",
                        "projectId": "1",
                        "groupTag": {"targetId":"abc"},
                        "libraryType": "RNAseq",
                        "libraryData":[
                            {
                            "layoutId": "imageArray",
                            "layoutTitle": "Generic Layout",
                            "tabId": "Tab1",
                            "tabTitle": "Tab 1",
                            "stepId": "1",
                            "workflowId": "1cd8e2f6b131e891",
                            "dataType": "png",
                            "dataLabel": "fig1.1"
                            "URL": "http://128.84.9.200:8080/datasets/7eee9617b2705f10/display?preview=True",
                            }
                        ]
                        "createdBy": "user1",
                        "createTimestamp":"2020-11-02",
                        "updatedBy": "user1,
                        "updateTimestamp":"2020-11-02",
                        "status":"1"           
                    }  
              ]
    }

```
